Phase 1 - Preprosessing Raw reads -> Map to reference (BWA MEM) -> Mark duplicates (Picard) -> Base recallibration -> Analysis ready reads

Phase 2 - Variant Discovery (Initial Variant Discovery) Analysis ready reads -> Var. Calling (HC -ERC GCVF) -> Genotype likelihoods

-> Joint Genotyping -> Raw variants: SNPs; Indels -> Filter Variants -> Analysis ready variants: SNPs; Indels

Phase 3 - Callset refinement (Variant Annotation and Priotorization) Analysis ready variants: SNPs; Indels -> Refine genotypes -> Annotate variants -> Evaluate callset -> Look good? troubleshoot or use in project

#!/usr/bin/env nextflow
 
params.in = "$baseDir/data/sample.fa"
sequences = file(params.in)
 
/*
 * trims adaptor sequences
 */
process adapttrim {
 
    input:
    file 'input.fa' from sequences
 
    output:
    file 'seq_*' into records
 
    """
    awk '/^>/{f="seq_"++d} {print > f}' < input.fa
    """
 
}
 
/*
 * Quality trimming
 */
process qualtrim {
 
    input:
    file x from records
     
    output:
    stdout result
 
    """
    cat $x | rev
    """
}
 
/*
 * Removal of very short leads
 */
result.subscribe { println it }

/*
 * De-duplication
process dedup {
 
    input:
    file 'input.fa' from sequences
 
    output:
    file 'seq_*' into records
 
    """
    awk '/^>/{f="seq_"++d} {print > f}' < input.fa
    """
 
}
